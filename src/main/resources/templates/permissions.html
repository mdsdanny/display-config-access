<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Permissions</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
</head>
<body>
<div id="root"></div>
<script src="https://unpkg.com/react@16.12.0/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@16.12.0/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone@7.8.3/babel.js"></script>
<script type="text/babel">
      function handleClick(event) {
        if (event) event.preventDefault()

        const permissions = listPermissions("list-all")
        if (permissions) {
          permissions.then(
            (response) => {
              console.log(response)
            },
            (errorData) => {
              console.log("error")
            }
          )
        } else {
          console.log("vacio")
        }
      }

      function addPermission({ permission }) {
        const newPermission = addNewPermission(
          "add-permission",
          { permission }.permission
        )
        if (newPermission) {
          newPermission.then(
            (response) => {
              console.log(response)
            },
            (errorData) => {
              console.log("error")
            }
          )
        } else {
          console.log("vacio")
        }
      }

      function addNewPermission(key, permission) {
        if (key !== "add-permission") return
        return window
          .fetch("/permissions/add-permission", {
            method: "POST",
            headers: {
              "content-type": "application/json;charset=UTF-8",
            },
            body: JSON.stringify({
              name: permission,
            }),
          })
          .then((r) => r.json())
          .then((response) => response)
      }

      function listPermissions(key) {
        console.log("inside list")

        if (key !== "list-all") return

        console.log("before request")
        return window
          .fetch("/permissions/list-permissions", {
            method: "POST",
            headers: {
              "content-type": "application/json;charset=UTF-8",
            },
            body: JSON.stringify({
              query: "list-all-permissions",
            }),
          })
          .then((r) => r.json())
          .then((response) => response)
      }

      function UsernameForm() {
        const [permission, setPermission] = React.useState("")
        const error = permission && permission.trim() !== '' ? null : 'Permission should have a value'
        const [permissionList, setPermissionList] = React.useState("")

        function handleSubmit(event) {
          event.preventDefault()
          addPermission({ permission })
        }

        function handleChange(event) {
          event.preventDefault()
          setPermission(event.target.value)
        }

        return (
          <div>
            <br />
            <form onSubmit={handleSubmit}>
              <div>
                <label htmlFor="permission">Permission Name: </label>
                <input id="permission" type="text" onChange={handleChange} />
                <button type="submit">
                  Add
                </button>
              </div>
            </form>
            <br />
            <div style={{color: 'red'}}>{error}</div>
            <br />
            <button type="button" onClick={handleClick}>
              List Permissions
            </button>
            <br />
            <ul id="permissionList" />
          </div>
        )

      }

      ReactDOM.render(<UsernameForm />, document.getElementById("root"))
</script>
</body>
</html>
